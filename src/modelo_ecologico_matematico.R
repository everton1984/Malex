########################################################
########### Este e o codigo de IC de PH ################
### email:paulo.pimenta@usp.br ... #####################
###... ou paulopimenta6@gmail.com ######################
########################################################


################@@@@@@@@@@@@@@@@@@@@@@###################



#########################################################
################Condicoes Iniciais#######################
#########################################################

A <- 0.057

B <- 16.12

e <- c(30, 10, 10)

K <- 10000

R <- c(73.9, 300.0, 600.0, 1000.0)

l <- c(228.4, 1470.4, 4195.1)

Radius <- numeric(0)

Radiuss <- numeric(0)

Radiusss <- numeric(0)

y <- list()

vector_length <- numeric(0)

f_floresta <- numeric(0)

nova_f_floresta <- numeric(0)

Ndiscs <- numeric(0)

f_h <- numeric(0)

nova_f_h <- numeric(0)

d_h <- numeric(0)

d_R <- numeric(0)

pre_integral <- numeric(0)

integral <- numeric(0)

IRE <- numeric(0)

AVIRE <- numeric(0)

################@@@@@@@@@@@@@@@@@@@@@@###################



#########################################################
##############Funcoes Usadas no Algoritmo################
#########################################################

#########################################################
############# INICIO DAS FUNCOES ########################
#########################################################

###funcao floresta###

funcao_floresta <- function(A, B, R){
  
  floresta <- (A*R + B)
  
  return(floresta)
  
}

###funcao h(r)###

funcao_h <- function(K, R, f_floresta){
  
  h <- K*(1/(2*pi*R*(f_floresta)))
  
  return(h)    
  
}

###funcao dh(r)###

funcao_dh <- function(K, A, B, R, f_floresta){  
  
  dh <- (K/6.28)*(2*A*R + B)/(R*f_floresta)^2
  
  return(dh)
  
}

###funcao dR###

funcao_dR <- function(e, l, d_h){
  
  dR <- (e/l)*(1/d_h)
  
  return(dR)
  
}

###funcao Ndiscs###

funcao_ndiscs <- function(R_max, R_min, d_R){
  
  ndiscs <- 1 + (R_max - R_min)/d_R
  
  return(ndiscs)
  
}    

########################################################
################ FIM DAS FUNCOES #######################
########################################################




################@@@@@@@@@@@@@@@@@@@@@@###################



#########################################################
################Atribuicao de valores as funcoes#########
#########################################################

#########################################################
##################### INICIO ############################
#########################################################

for (i in 1:4){ 
  
  f_floresta[i] <- funcao_floresta(A, B , R[i])
  
  #########################################################	
  
  f_h[i] <- funcao_h(K, R[i], f_floresta[i])
  
  #########################################################
  
  d_h[i] <- funcao_dh(K, A, B, R[i], f_floresta[i]) 
  
  #########################################################
  
  d_R[i] <- funcao_dR(e[i], l[i], d_h[i])
  
  #########################################################
  
  Ndiscs[i] <- funcao_ndiscs(R[i+1], R[i], d_R[i])
  
}	

#########################################################
################ FIM DAS ATRIBUICOES ####################
#########################################################

################@@@@@@@@@@@@@@@@@@@@@@###################

#########################################################
############## Testes dos comprimentos ##################
#########################################################


##########################################################


####################@@@@@@@@@@@@@@@@@@@@##############################

for (j in 1:trunc(Ndiscs[1])){
  
  i <- 1
  
  Radius[i] <- R[i]
  Radius[j+1] <- Radius[j] + d_R[i]  
  
}

Radius_1 <- Radius[which(Radius<=300)]
Radius_1

#########################################################
#########################################################

for (j in 1:trunc(Ndiscs[2])){
  
  i <- 1
  
  Radiuss[i] <- 300
  Radiuss[j+1] <- Radiuss[j] + d_R[i+1]  
  
}

Radius_2 <- Radiuss[which(Radiuss<=600)]
Radius_2

##########################################################
##########################################################

for (j in 1:trunc(Ndiscs[3])){
  
  i <- 1
  
  Radiusss[i] <- 600
  Radiusss[j+1] <- Radiusss[j] + d_R[i+2]  
  
}

Radius_3 <- Radiusss[which(Radiusss<=1000)]
Radius_3

Radius_vec <- c(Radius_1, Radius_2, Radius_3)

############################################################################################

f_floresta

f_h

d_h

d_R[-4]

trunc(Ndiscs[-4])

Radius_vec

###########################################################################################

###########################################################################################
##comando para ler um arquivo ".dbf"                                                     ##
##                                                                                       ## 
##library("foreign")                                                                     ##
##                                                                                       ##
##read.dbf("F:/qgis_1/exercicio_buffer_L1/testes/teste_1/corte_estrada_aneis.dbf")       ##
##                                                                                       ## 
###########################################################################################
##
##Salvando tudo em forma de lista

library("foreign")

setwd("./data/teste_1")

arquivos <- list.files(pattern="\\.dbf$")

vetor1<-paste("corte_estrada_aneis",1:91,".dbf",sep="")
vetor1

vetor2<-sort(vetor1)
vetor2

numeros<-as.numeric(gsub("[a-z_.]", "\\1", vetor2))
numeros

x <- lapply(arquivos, read.dbf)

j <- x[order(numeros)]

##Exportando os comprimentos de cada estrada cortada por um anel

for (i in 1:91){
  
  vector_length[i] <- sum(j[[i]][,2])
  
}

###########################################################################################

j

vector_length

###########################################################################################
#######################FIM DA PRIMEIRA FASE DO ALGORITMO###################################
###########################################################################################

###########################################################################################
####################@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#################
###########################################################################################

###########################################################################################
###############NESTA FASE SERA USADA A FUNCAO h(R) NOVAMENTE, MAS DESTA VEZ TODOS OS RAIOS#
#...SERAO USADOS NA FUNCAO PARA QUE A INTEGRAL NUMERICA SEJA CALCULADA#####################
###########################################################################################

###########################################################################################
###########################USANDO NOVAMENTE A FUNCAO h(R)##################################
###########################################################################################

for (i in 1:91){ 
  
  nova_f_floresta[i] <- funcao_floresta(A, B , Radius_vec[i])
  
  nova_f_h[i] <- funcao_h(K, Radius_vec[i], nova_f_floresta[i])
  
  IRE[i] <- K/(nova_f_floresta[i])
  
  AVIRE[i] <- IRE[i]/(2*pi*(Radius_vec[i])) 
  
} 

###########################################################################################
##############Valores das novas funcoes florestas e funcao h(R)############################
###########################################################################################

nova_f_floresta

nova_f_h

############################################################################################
##############Antes da integral fiz o produto de um componente do vetor pelo outro##########
############################################################################################


pre_integral <- nova_f_h*vector_length 

integral <- sum(pre_integral)

integral

IRE

AVIRE

############################################################################################
############################################################################################
